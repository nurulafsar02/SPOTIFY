<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Spotify Style Player</title>

<script src="https://www.youtube.com/iframe_api"></script>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#121212;color:#fff}
.app{display:flex;height:100vh}
.sidebar{width:320px;background:#000;padding:20px;overflow:auto}
.sidebar h2{color:#1db954}
.sidebar button,input{width:100%;padding:10px;margin:6px 0;border:none;border-radius:4px}
.sidebar button{background:#1db954;font-weight:bold;cursor:pointer}
.sidebar li{list-style:none;padding:10px;border-radius:4px;cursor:pointer}
.sidebar li:hover{background:#282828}

.player{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}
.controls button{font-size:26px;margin:10px;background:none;border:none;color:white;cursor:pointer}
#ytplayer{margin-top:15px}
footer{position:fixed;bottom:0;width:100%;background:#181818;padding:8px;text-align:center}
</style>
</head>

<body>

<div class="app">

<!-- Sidebar -->
<div class="sidebar">
  <h2>üéµ MyMusic</h2>

  <button onclick="fileInput.click()">Upload MP3</button>

  <input type="text" id="search" placeholder="Search singer or song">
  <button onclick="searchSong()">Search YouTube</button>

  <ul id="playlist"></ul>
</div>

<!-- Player -->
<div class="player">
  <h2 id="title">No song playing</h2>

  <div class="controls">
    <button onclick="prev()">‚èÆ</button>
    <button onclick="playPause()">‚ñ∂ / ‚è∏</button>
    <button onclick="next()">‚è≠</button>
  </div>

  <input type="range" id="progress" value="0" style="width:300px">
  <input type="range" id="volume" min="0" max="1" step="0.01" value="1" style="width:300px">

  <div id="ytplayer"></div>
</div>

</div>

<footer>Spotify Style Player | Offline + YouTube Streaming</footer>

<input type="file" id="fileInput" accept="audio/*" multiple hidden>

<script>
const API_KEY = "AIzaSyASMJNEGj___jWguaLPdjSNEp3gxAbWG7o";

const audio = new Audio();
let songs = JSON.parse(localStorage.getItem("songs")) || [];
let current = 0;
let mode = "offline";

const playlist = document.getElementById("playlist");
const title = document.getElementById("title");
const progress = document.getElementById("progress");
const volume = document.getElementById("volume");
const fileInput = document.getElementById("fileInput");

volume.oninput = () => audio.volume = volume.value;

fileInput.onchange = e => {
  for (let file of e.target.files) {
    const url = URL.createObjectURL(file);
    songs.push({ name: file.name, url });
  }
  localStorage.setItem("songs", JSON.stringify(songs));
  renderPlaylist();
};

function renderPlaylist() {
  playlist.innerHTML = "<h3>Offline Songs</h3>";
  songs.forEach((song, i) => {
    const li = document.createElement("li");
    li.textContent = "üéµ " + song.name;
    li.onclick = () => playSong(i);
    playlist.appendChild(li);
  });
}

function playSong(index) {
  mode = "offline";
  current = index;
  audio.src = songs[current].url;
  audio.play();
  title.textContent = songs[current].name;
}

function playPause() {
  if(mode==="offline"){
    audio.paused ? audio.play() : audio.pause();
  }else{
    player.getPlayerState()==1 ? player.pauseVideo() : player.playVideo();
  }
}

function next() {
  if(mode==="offline"){
    current = (current + 1) % songs.length;
    playSong(current);
  }
}

function prev() {
  if(mode==="offline"){
    current = (current - 1 + songs.length) % songs.length;
    playSong(current);
  }
}

audio.ontimeupdate = () => {
  progress.value = (audio.currentTime / audio.duration) * 100 || 0;
};

progress.oninput = () => {
  audio.currentTime = (progress.value / 100) * audio.duration;
};

renderPlaylist();


// ================== YOUTUBE PLAYER ===================
let player;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('ytplayer', {
    height: '220',
    width: '320',
    videoId: '',
    playerVars: { 'playsinline': 1 }
  });
}

async function searchSong() {
  const q = document.getElementById("search").value;
  if(!q) return alert("Enter singer or song name");

  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=12&q=${encodeURIComponent(q)}&key=${API_KEY}`;

  const res = await fetch(url);
  const data = await res.json();

  playlist.innerHTML = "<h3>YouTube Results</h3>";

  data.items.forEach(video => {
    const li = document.createElement("li");
    li.textContent = "‚ñ∂ " + video.snippet.title;
    li.onclick = () => playYouTube(video.id.videoId, video.snippet.title);
    playlist.appendChild(li);
  });
}

function playYouTube(id, name) {
  mode = "youtube";
  title.textContent = name;
  player.loadVideoById(id);
}
</script>

</body>
</html>
